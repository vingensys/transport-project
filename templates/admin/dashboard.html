{% extends "admin/base.html" %}

{% block content %}

<h2 class="mb-4 text-center">Admin Dashboard</h2>

<!-- TOP-LEVEL TABS -->
<ul class="nav nav-tabs" id="adminMainTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button
      class="nav-link"
      id="main-overview-tab"
      data-bs-toggle="tab"
      data-bs-target="#overview"
      type="button"
      role="tab"
    >
      Overview
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      class="nav-link active"
      id="main-masterdata-tab"
      data-bs-toggle="tab"
      data-bs-target="#masterdata"
      type="button"
      role="tab"
    >
      Master Data
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      class="nav-link"
      id="main-agreement-tab"
      data-bs-toggle="tab"
      data-bs-target="#agreement"
      type="button"
      role="tab"
    >
      Agreements
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      class="nav-link"
      id="main-route-tab"
      data-bs-toggle="tab"
      data-bs-target="#route"
      type="button"
      role="tab"
    >
      Route Builder
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      class="nav-link"
      id="main-booking-tab"
      data-bs-toggle="tab"
      data-bs-target="#booking"
      type="button"
      role="tab"
    >
      Booking
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      class="nav-link"
      id="main-history-tab"
      data-bs-toggle="tab"
      data-bs-target="#history"
      type="button"
      role="tab"
    >
      History
    </button>
  </li>

  <li class="nav-item" role="presentation">
    <button
      class="nav-link"
      id="main-letters-tab"
      data-bs-toggle="tab"
      data-bs-target="#letters"
      type="button"
      role="tab"
    >
      Letters
    </button>
  </li>
</ul>

<div
  class="tab-content p-4 border border-top-0 bg-white"
  id="adminMainTabsContent"
  style="min-height: 260px;"
>

  <!-- OVERVIEW -->
  <div
    class="tab-pane fade"
    id="overview"
    role="tabpanel"
    aria-labelledby="main-overview-tab"
  >
    {% include "admin/_tab_overview.html" %}
  </div>


  <!-- MASTER DATA TAB WITH INNER TABS -->
  <div
    class="tab-pane fade show active"
    id="masterdata"
    role="tabpanel"
    aria-labelledby="main-masterdata-tab"
  >
    <h5 class="mb-3">Master Data</h5>

    <!-- INNER TABS (Pills) -->
    <ul class="nav nav-pills mb-3" id="masterDataTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button
          class="nav-link active"
          id="company-tab"
          data-bs-toggle="tab"
          data-bs-target="#company"
          type="button"
          role="tab"
        >
          Companies
        </button>
      </li>

      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="lorry-tab"
          data-bs-toggle="tab"
          data-bs-target="#lorry"
          type="button"
          role="tab"
        >
          Lorries
        </button>
      </li>

      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="location-tab"
          data-bs-toggle="tab"
          data-bs-target="#location"
          type="button"
          role="tab"
        >
          Locations
        </button>
      </li>

      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="authority-tab"
          data-bs-toggle="tab"
          data-bs-target="#authority"
          type="button"
          role="tab"
        >
          Authorities
        </button>
      </li>

      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="authority-tab"
          data-bs-toggle="tab"
          data-bs-target="#config"
          type="button"
          role="tab"
        >
          Configuration
        </button>
      </li>

    </ul>

    <!-- INNER TAB CONTENT -->
    <div class="tab-content" id="masterDataTabsContent">
      <div
        class="tab-pane fade show active"
        id="company"
        role="tabpanel"
        aria-labelledby="company-tab"
      >
        {% include "admin/_tab_company.html" %}
      </div>

      <div
        class="tab-pane fade"
        id="lorry"
        role="tabpanel"
        aria-labelledby="lorry-tab"
      >
        {% include "admin/_tab_lorry.html" %}
      </div>

      <div
        class="tab-pane fade"
        id="location"
        role="tabpanel"
        aria-labelledby="location-tab"
      >
        {% include "admin/_tab_location.html" %}
      </div>

      <div
        class="tab-pane fade"
        id="authority"
        role="tabpanel"
        aria-labelledby="authority-tab"
      >
        {% include "admin/_tab_authority.html" %}
      </div>
      
      <div
        class="tab-pane fade"
        id="config"
        role="tabpanel"
        aria-labelledby="authority-tab"
      >
        {% include "admin/_tab_config.html" %}
      </div>

    </div>
  </div>

  <!-- AGREEMENTS MAIN TAB -->
  <div
    class="tab-pane fade"
    id="agreement"
    role="tabpanel"
    aria-labelledby="main-agreement-tab"
  >
    {% include "admin/_tab_agreement.html" %}
  </div>

  <!-- ROUTE BUILDER MAIN TAB -->
  <div
    class="tab-pane fade"
    id="route"
    role="tabpanel"
    aria-labelledby="main-route-tab"
  >
    {% include "admin/_tab_route.html" %}
  </div>

  <!-- BOOKING MAIN TAB -->
  <div
    class="tab-pane fade"
    id="booking"
    role="tabpanel"
    aria-labelledby="main-booking-tab"
  >
    {% include "admin/_tab_booking.html" %}
  </div>

  <!-- BOOKING HISTORY TAB -->
  <div
    class="tab-pane fade"
    id="history"
    role="tabpanel"
    aria-labelledby="main-history-tab"
  >
    {% include "admin/_tab_history.html" %}
  </div>

  <!-- LETTERS MAIN TAB -->
  <div
    class="tab-pane fade"
    id="letters"
    role="tabpanel"
    aria-labelledby="main-letters-tab"
  >
  </div>

</div>

<!-- Booking Details Modal (global, for Bookings + History tabs) -->
<div class="modal fade" id="bookingDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Booking Details</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <dl class="row mb-3">
          <dt class="col-sm-3">Trip ID</dt>
          <dd class="col-sm-9" id="bookingDetailTripSerial"></dd>

          <dt class="col-sm-3">Booking ID</dt>
          <dd class="col-sm-9" id="bookingDetailBookingId"></dd>

          <dt class="col-sm-3">Booking Date</dt>
          <dd class="col-sm-9" id="bookingDetailBookingDate"></dd>

          <dt class="col-sm-3">Placement Date</dt>
          <dd class="col-sm-9" id="bookingDetailPlacementDate"></dd>

          <dt class="col-sm-3">Company</dt>
          <dd class="col-sm-9" id="bookingDetailCompany"></dd>

          <dt class="col-sm-3">Lorry Type</dt>
          <dd class="col-sm-9" id="bookingDetailLorry"></dd>

          <dt class="col-sm-3">From</dt>
          <dd class="col-sm-9" id="bookingDetailFrom"></dd>

          <dt class="col-sm-3">Destination</dt>
          <dd class="col-sm-9" id="bookingDetailDest"></dd>

          <dt class="col-sm-3">Route</dt>
          <dd class="col-sm-9" id="bookingDetailRoute"></dd>

          <dt class="col-sm-3">Route KM</dt>
          <dd class="col-sm-9" id="bookingDetailTripKm"></dd>
        </dl>

        <hr class="my-2">

        <h6 class="mb-2">Materials</h6>
        <div class="table-responsive" style="max-height: 260px; overflow-y: auto;">
          <table class="table table-sm table-bordered align-middle mb-0">
            <thead class="table-light">
              <tr class="text-center">
                <th style="width: 40px;">Sl.</th>
                <th>Description</th>
                <th style="width: 90px;">Unit</th>
                <th style="width: 90px;">Qty</th>
                <th style="width: 110px;">Rate</th>
                <th style="width: 120px;">Amount</th>
              </tr>
            </thead>
            <tbody id="bookingDetailMaterialsBody">
              <tr class="text-muted">
                <td colspan="6">No material details available.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mt-2 small text-muted" id="bookingDetailMaterialsSummary"></div>
      </div>
    </div>
  </div>
</div>

<div id="dashboard-root" data-default-tab="{{ request.args.get('tab', '') }}"></div>

{% endblock %}

{% block extra_scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/route.js') }}"></script>
  <script src="{{ url_for('static', filename='js/location.js') }}"></script>
  <script src="{{ url_for('static', filename='js/dashboard_tabs.js') }}"></script>
{% endblock %}
