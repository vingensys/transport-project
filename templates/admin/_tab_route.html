<h5 class="mb-3">Route Builder</h5>

<!-- 3-pane Route Builder -->
<div class="card mb-4">
  <div class="card-header">
    Define Route (From / Via / To) & Distance
  </div>
  <div class="card-body">
    <form method="POST" action="{{ url_for('admin.add_route') }}" id="routeBuilderForm">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div class="row">

        <!-- FROM side -->
        <div class="col-lg-4 mb-3">
          <div class="border rounded p-3 h-100">
            <h6 class="mb-2">From Side Locations</h6>

            <div class="input-group mb-2">
              <input
                type="text"
                class="form-control"
                placeholder="Type name or code..."
                list="routeLocationList"
                data-role="from-input"
              >
              <button
                class="btn btn-outline-secondary"
                type="button"
                data-role="from-add"
              >
                Add
              </button>
            </div>

            <ul class="list-group small" id="fromLocationList"></ul>
          </div>
        </div>

        <!-- INTERMEDIATE -->
        <div class="col-lg-4 mb-3">
          <div class="border rounded p-3 h-100">
            <h6 class="mb-2">Intermediate Locations</h6>

            <div class="input-group mb-2">
              <input
                type="text"
                class="form-control"
                placeholder="Type name or code..."
                list="routeLocationList"
                data-role="mid-input"
              >
              <button
                class="btn btn-outline-secondary"
                type="button"
                data-role="mid-add"
              >
                Add
              </button>
            </div>

            <ul class="list-group small" id="midLocationList"></ul>
          </div>
        </div>

        <!-- TO side -->
        <div class="col-lg-4 mb-3">
          <div class="border rounded p-3 h-100">
            <h6 class="mb-2">To Side Locations</h6>

            <div class="input-group mb-2">
              <input
                type="text"
                class="form-control"
                placeholder="Type name or code..."
                list="routeLocationList"
                data-role="to-input"
              >
              <button
                class="btn btn-outline-secondary"
                type="button"
                data-role="to-add"
              >
                Add
              </button>
            </div>

            <ul class="list-group small" id="toLocationList"></ul>
          </div>
        </div>

      </div>

      <hr>

      <!-- Distance + Remarks -->
      <div class="row g-3 align-items-end">
        <div class="col-md-2">
          <label class="form-label">Total Distance (KM)</label>
          <input
            type="number"
            class="form-control"
            name="total_km"
            min="1"
            placeholder="e.g., 420"
            required
          >
        </div>

        <div class="col-md-6">
          <label class="form-label">Remarks (optional)</label>
          <input
            type="text"
            class="form-control"
            name="remarks"
            placeholder="e.g., RPM – PER – AJJ – ED via PER cluster"
          >
        </div>

        <div class="col-md-4 text-md-end">
          <button class="btn btn-primary mt-3 mt-md-0">
            Save Route
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Existing Routes Table -->
{% if routes %}
  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:60px;">ID</th>
          <th style="width:160px;">Code</th>
          <th>Name</th>
          <th style="width:90px;">Total KM</th>
          <th style="width:90px;">Active</th>
          <th>Remarks</th>
        </tr>
      </thead>
      <tbody>
      {% for r in routes %}
        <tr>
          <td>{{ r.id }}</td>
          <td>{{ r.code }}</td>
          <td>{{ r.name }}</td>
          <td>{{ r.total_km }}</td>
          <td>{{ "Yes" if r.is_active else "No" }}</td>
          <td>{{ r.remarks or "-" }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p class="text-muted">No routes defined yet.</p>
{% endif %}

<!-- Datalist of locations -->
<datalist id="routeLocationList">
  {% for loc in all_locations %}
    <option value="{{ loc.name }} [{{ loc.code }}]"></option>
  {% endfor %}
</datalist>
